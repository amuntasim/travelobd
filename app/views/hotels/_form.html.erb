<%= content_for :js_css_include do %>
    <%= javascript_include_tag 'jquery.validate' %>
    <%= stylesheet_link_tag 'jquery-ui', 'autocomplete' %>
<% end %>

<%= form_for(@hotel, :html=> {:multipart => true, :id=> 'hotel_form'}) do |f| %>
    <% @builder = f %>
    <% if @hotel.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@hotel.errors.count, "error") %> prohibited this hotel from being saved:</h2>

          <ul>
            <% @hotel.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
    <% end %>
    <div style="font-size: 16px; font-weight: bold; color: #9f1010" id="summary">

    </div>
    <div class="item_form_row">
      <label>
        <span>*</span> Category:
      </label>

      <%= f.select :category_id, Hotel::CATEGORIES, :prompt=> 'Select Category' %>
    </div>

    <div class="item_form_row">
      <label>
        <span>*</span> Name:
      </label>
      <%= f.text_field :name %>
    </div>
    <div class="item_form_row">
      <%= f.label :description %>
      <%= f.text_area :description, :class => "mceEditor" %>
    </div>

    <div class="item_form_row">
      <%= f.label :features %>
      <% @features_for_hotel.each do |feature| %>
          <%= check_box_tag "hotel[feature_ids][]", feature.id, hotel_feature_present?(feature) -%>
          <%= feature.name -%>

      <% end %>

    </div>

    <div class="item_form_row">
      <label>
        <span>*</span> Division:
      </label>
      <%= f.select :division_id, Division.all.collect { |d| [d.name, d.id] }, :include_blank => '--Select--' %>

    </div>
    <div class="item_form_row">
      <label>
        <span>*</span>
        District
      </label>
      <%= f.select :district_id, District.all.collect { |d| [d.name, d.id] }, :include_blank => '--Select--' %>
      <%= image_tag 'spin.gif', :id => 'district_loading', :class => 'loading_image' %>
    </div>


    <div class="item_form_row">
      <label>
        <span>*</span> Phone:
      </label>
      <%= f.text_field :phone %>
    </div>
    <div class="item_form_row">
      <label>
        <span>*</span> Discount:
      </label>
      <%= f.text_field :discount %>
    </div>
    <div class="item_form_row">
      <label>
        <span>*</span> Discount till:
      </label>
      <%= f.text_field :discount_till %>
    </div>
    <div class="item_form_row">
      <label>
        Rating:
      </label>

      <div class="hotel_star_rating">
        <div class="rating_radios">
          <%= f.radio_button :star_rating, 1, :disabled =>"disabled" %>
          <%= f.radio_button :star_rating, 2, :disabled =>"disabled" %>
          <%= f.radio_button :star_rating, 3, :title => '3 Star' %>
          <%= f.radio_button :star_rating, 4, :title => '4 Star' %>
          <%= f.radio_button :star_rating, 5, :title => '5 Star' %>
          <br>
          <span class="star"></span>
          <span class="star"></span>
          <span class="star"></span>
          <span class="star"></span>
          <span class="star"></span>
        </div>


      </div>

    </div>

    <div class="item_form_row">
      <label>
        Active:
      </label>
      <%= f.check_box :active %>
    </div>
    <div class="item_form_row">
      <label> Image:</label>

      <div class="photo_box">
        <!-- <h3>Images <span style="font-size: 11px;"><%#= ad_photo_number_str(@hotel) %></span></h3>-->
        <div class="edit_img_row">

          <% unless @hotel.new_record? %>
              <%= render :partial => 'existing_photo', :collection => @hotel.assets %>
          <% end %>

          <div id="hotel_photos">
            <%= render :partial => 'photo', :locals => {:form => f, :photo => @hotel.assets.new} if @hotel.new_record? %>
          </div>

        </div>
        <%= link_to '+Ad More', 'javascript:void(0)', :class=>'adMore addMoreImage' %>
      </div>
    </div>
    <div class="item_form_row">
      <label>&nbsp;</label>

      <%= f.submit '', :class=> 'subBtn' %>
    </div>
<% end %>

<div style="display: none">

  <div id="new_photo_html">
    <%= render(:partial => 'photo', :locals => {:form => @builder}, :object => @hotel.assets.new) %>
  </div>

</div>

<style type="text/css">
    .hotel_star_rating {
        float: left;
        width: 200px;
    }

    .hotel_star_rating .star {
        background: url("/images/star.png") no-repeat;
        width: 10px;
        height: 10px;
        float: left;
    }

    .hotel_star_rating input {
        margin-right: 5px;
        cursor: pointer;
    }

    .hotel_star_rating .star {
        margin-left: 2px;
        margin-right: 10px;
    }
</style>

<script type="text/javascript">
    var allowed_images = 5;

    $.fn.divisionChanged = function() {
        $('#hotel_division_id').change(function() {
            $('#district_loading').toggle();
            $.ajax({
                url: '/welcome/load_districts?&target=hotel_district_id&division_id=' + $(this).val(),
                type: 'get',
                dataType: 'script',
                success: function(results) {
                    $('#district_loading').toggle();
                }
            });
        });
    }

    $(document).ready(function() {


        var validator = $("#hotel_form").validate({
            invalidHandler: function() {
                $("#summary").html('<div class="item_form_row">' + validator.numberOfInvalids() + " field(s) are invalid, * marked fields are required </div>");
            },
            errorPlacement: function(error, element) {
                error.remove();
            },


            rules: {
                'hotel[category_id]': "required",
                'hotel[name]' : "required",
                'hotel[division_id]' : "required",
                'hotel[district_id]' : "required",
                'hotel[phone]' : "required"

            },
            messages: {
                comment: "Please enter a comment."
            }
        });

        $('#hotel_discount_till').datepicker({
            changeMonth: true,
            changeYear: true
        });

        $(this).addMorePhoto('hotel_photos', allowed_images);
        $(this).deleteAsset('hotels');
        $(this).makeMainPhoto('hotels');
        $(this).divisionChanged();
    });


</script>
