<%= content_for :js_css_include do %>
  <%= javascript_include_tag 'jquery.validate' %>
  <%= stylesheet_link_tag 'jquery-ui', 'autocomplete' %>
<% end %>

<%= form_for(@ad, :html => { :multipart => true, :id=> 'ad_form'}) do |f| %>
  <% @builder = f %>
  <% if @ad.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@ad.errors.count, "error") %> prohibited this ad from being saved:</h2>

      <ul>
        <% @ad.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="dir_sign_row">
    <label> <span>*</span>Category :</label>
    <%= f.select :category_id, Ad::CATEGORIES, :prompt=> 'Select Category' %>
  </div>


  <div class="dir_sign_row">
    <label> <span>*</span>Tittle :</label>
    <%= f.text_field :title  %>
  </div>


  <div class="dir_sign_row">
    <label> Short Description :</label>
    <%= f.text_field :short_description %>
  </div>


  <div class="dir_sign_row">
    <label><span>*</span>  Asking Price :</label>
    <%= f.text_field :price %>
  </div>


  <div class="dir_sign_row">
    <label> <span>*</span> Phone# :</label>
    <%= f.text_field :phone %>
  </div>



  <div class="dir_sign_row">
    <label> <span>*</span> Describe Your Package :</label>
    <%= f.text_area :description %>
  </div>

  <div class="dir_sign_row">
    <label> Image:</label>

    <div class="f_edit_row">
      <h3>Images <span style="font-size: 11px;">(<%= ad_photo_number_str(@ad) %>)</span></h3>
      <div class="f_edit_top"></div>
      <div class="f_edit_mid">
        <div class="edit_img_row">

          <% unless @ad.new_record? %>
            <%= render :partial => 'existing_photo', :collection => @ad.assets %>
          <% end %>

          <div  id="ad_photos">
            <%= render :partial => 'photo', :locals => { :form => f, :photo => @ad.assets.new } if @ad.new_record? %>
          </div>

        </div>
        <%= link_to '+Ad More', 'javascript:void(0)', :class=>'adMore addMoreImage' %>
  <%#= add_object_link("+Add More", f, @ad.assets.new, "photo", "#ad_images", 'adMore addMoreImage') %>
      </div>
      <div class="f_edit_bot"></div>
    </div>
    <% if @ad.featured? %>
      <div class="tubeRow">
        <div class="tube_input_area">
          <label>You Tube Video Link</label>
          <div id="ad_videos">
            <%= render :partial => 'video', :collection => @ad.videos, :locals => { :form => f} %>
          </div>
          <%= link_to '+Ad More', 'javascript:void(0)', :class=>'adMore adMoreVideo' %>
        </div>

      </div>
    <% end %>
  </div>
  <div class="bigleftmar">
    <input type="submit" class="submit" value="<%= @ad.new_record? ? "CREATE" : "UPDATE" %>"></input>

  </div>


<% end %>
<div style="display: none">
  <div id="new_video_html">
    <%= render(:partial => 'video', :locals => { :form => @builder}, :object => @ad.videos.new) %>
  </div>


  <div id="new_photo_html">
    <%= render(:partial => 'photo', :locals => { :form => @builder}, :object => @ad.assets.new) %>
  </div>

</div>

<style type="text/css">

  .photo{
    float: left;
    width:100%;
  }

  .f_edit_row input.photo {width: 260px; margin: 5px 0}

  div#ad_images {width: 325px; }

  #ad_videos .video {
    float: left;
    width: 240px;
    padding: 5px 0;
  }
  #ad_videos .cross {
    margin: 5px;
    float: left;
  }



  .tube_input_area, .tube_input_digree {width: 240px;}
  .tube_input_digree input {margin-left: 108px;}
  .f_edit_row_big textarea {height: 85px;}

  input.submit {
    background:url("/images/choose_btn.png") no-repeat scroll 0 0 transparent;
    border:0 none;
    color:#FFFFFF;
    display:inline;
    float:left;
    font-size:22px;
    height:58px;
    margin-top:10px;
    text-align:center;
    text-decoration:none;
    text-transform:uppercase;
    width:244px;
    font-weight: bold;
  }

  .f_edit_row .radio_area{
    float: left;
    width: 120px;
  }

</style>
<script type="text/javascript">
  var allowed_images = 3;
  var allowed_videos = 0;
<%if @ad.featured?%>
    allowed_images =  <%=@ad_settings['featured_package_photos'] || 15 %>;
    allowed_videos =  <%=@ad_settings['featured_package_videos'] || 2 %>;
<%end%>


  
  SubmittingForm=function(form) {
    //alert("The form has been validated.");
  }


  $(document).ready(function() {
        
    $('a.adMoreDiscipline').click(function(){
      var new_object_id = new Date().getTime() ;
      var html = $($('#new_discipline_html').html().replace(/index_to_replace_with_js/g, new_object_id)).hide();
      html.appendTo($('#ad_disciplines')).slideDown('slow');
      $('a.removeDiscipline').click(function(){
        $(this).parents('.discipline').remove();
      });
      
      $('a.removeDiscipline').click(function(){
        $(this).parents('.discipline').remove();
      });
    });

    

    $('a.removeDiscipline').click(function(){
      $(this).parents('.discipline').remove();
    });

    $('a.adMoreAssociation').click(function(){
      var new_object_id = new Date().getTime() ;
      var html = $($('#new_association_html').html().replace(/index_to_replace_with_js/g, new_object_id)).hide();
      html.appendTo($('#ad_associations')).slideDown('slow');
      $('a.removeDiscipline').click(function(){
        $(this).parents('.association').remove();
      });
      

      $('a.removeAssociation').click(function(){
        $(this).parents('.association').remove();
      });
    });

    $('a.removeAssociation').click(function(){
      $(this).parents('.association').remove();
    });

    
   
    $('span.removeImageField').click(function(){
      $(this).parents('.photo').remove();
    });
   


    $('a.adMoreVideo').click(function(){
      if($($('a.removeVideo')).length > allowed_videos){
        alert('Maximum allowed '+allowed_videos);
        return false;
      }
      else{
        var new_object_id = new Date().getTime() ;
        var html = $($('#new_video_html').html().replace(/index_to_replace_with_js/g, new_object_id)).hide();
        html.appendTo($('#ad_videos')).slideDown('slow');
        $('a.removeVideo').click(function(){
          $(this).parents('.video').remove();
        });
      }
      
    });

    $('a.removeVideo').click(function(){
      $(this).parents('.video').remove();
    });

    


    $('#ad_birth_date').datepicker({
      changeMonth: true,
      changeYear: true
    });

   

    $("#ad_form").validate({
      errorPlacement: function(error, element) {
        error.remove();
      },


      rules: {
        'ad[category_id]': "required",
        'ad[title]' : "required",
        'ad[ad_name]': "required"
        //ad_ad_name: "required",
        //ad_short_description: "required"
        
      },
      messages: {
        comment: "Please enter a comment."
      }
    });

    $('#district_auto_complete').autocomplete({
      source: '/districts/autocomplete',
      //width: '200px',
      select: function(event, ui) {
        $(this).val(ui.item.value);
        $('#ad_district_id').val(ui.item.id);
        return false;
      }
    });

    $('#division_auto_complete').autocomplete({
      source: '/divisions/autocomplete',
      //width: '200px',
      select: function(event, ui) {
        $(this).val(ui.item.value);
        $('#ad_division_id').val(ui.item.id);
        return false;
      }
    });

    $(this).addMorePhoto('ad_photos', allowed_images);
    $(this).deleteAsset('ads');
    $(this).makeMainPhoto('ads');

  });


</script>
