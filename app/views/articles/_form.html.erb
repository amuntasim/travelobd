<%= content_for :js_css_include do %>
  <%= javascript_include_tag 'jquery.validate' %>
  <%= stylesheet_link_tag 'jquery-ui', 'autocomplete' %>
<% end %>

<%= form_for(@article,  :html => { :multipart => true,:id=> 'article_frm'}) do |f| %>
  <% @builder = f %>
  <% if @article.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@article.errors.count, "error") %> prohibited this article from being saved:</h2>

      <ul>
        <% @article.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <div style="font-size: 16px; font-weight: bold; color: #9f1010" id="summary">

  </div>
  <div class="dir_sign_row">
    <label>
      <span>*</span> Category:
    </label>
    <%= f.select :category_id, Article::CATEGORIES, :prompt=> 'Select Category' %>
  </div>

  <div class="dir_sign_row">
    <label>
      <span>*</span> Title:
    </label>
    <%= f.text_field :title, :class=> 'txt' %>
  </div>

  <div class="dir_sign_row">
    <label>
      <span>*</span>Detail:
    </label>
    <%= f.text_area :detail, :class => "mceEditor" %>
  </div>
  <div class="dir_sign_row">

    <div class="f_edit_row mtop10">
      <div class="f_edit_top"></div>
      <div class="f_edit_mid">
        <div class="edit_img_row">

          <% unless @article.new_record? %>
            <%= render :partial => 'existing_photo', :collection => @article.assets %>
          <% end %>

          <div  id="article_photos" class="more_photos_form">
            <%= render :partial => 'photo', :locals => { :form => f, :photo => @article.assets.new } if @article.new_record? %>
          </div>

        </div>
        <%= link_to '+Ad More', 'javascript:void(0)', :class=>'adMore addMoreImage' %>
      </div>
      <div class="f_edit_bot"></div>
    </div>


  </div>


  <div class="dir_sign_row">
    <label>&nbsp;</label>
    <%= f.submit '', :class=>"subBtn" %>
  </div>


<% end %>

<div style="display: none">

  <div id="new_photo_html">
    <%= render(:partial => 'photo', :locals => { :form => @builder}, :object => @article.assets.new) %>
  </div>

</div>


<script type="text/javascript">

  var allowed_images = 5;
  
  $(document).ready(function() {
    $('#article_frm').submit(function() {
      tinyMCE.triggerSave();
    });
    var validator = $("#article_frm").validate({
      invalidHandler: function() {
        $("#summary").html('<div class="dir_sign_row">'+validator.numberOfInvalids() + " field(s) are invalid, * marked fields are required </div>");
      },
      errorPlacement: function(error, element) {
        error.remove();
      },


      rules: {
        'article[category_id]': "required",
        'article[title]' : "required",
        'article[detail]' : "required"

      },
      messages: {
        comment: "Please enter a comment."
      }
    });
    
    $(this).addMorePhoto('article_photos', allowed_images);
    $(this).deleteAsset('articles');
    $(this).makeMainPhoto('articles');
    
  });


</script>
